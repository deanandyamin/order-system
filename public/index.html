<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ç·šä¸Šé»é¤</title>
  <style>
    /* =========================
       å…¨å±€è®Šæ•¸èˆ‡ä¸»é¡Œè¨­å®š
       ========================= */
    :root {
      --brand-color: #fd7e14;
      --brand-color-dark: #e36e10;
      --text-color: #333;
      --bg-color: #f4f4f4;
      --cart-bg: #fff9db;
      --cart-bg-confirm: #ffd6d6;
      --white: #fff;
      --border-color: #ddd;
      --transition-fast: 0.3s;
    }
    /* =========================
       å…¨å±€æ¨£å¼
       ========================= */
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
    }
    /* =========================
       Header å€å¡Šï¼šåˆä½µåº—å®¶ Logo èˆ‡é¡åˆ¥é¸å–®
       æ­¤å€å›ºå®šæ–¼é é¢æœ€ä¸Šæ–¹ï¼Œç¸½é«˜åº¦ç´„ 2cm + 50px = ç´„ 130px
       ========================= */
    .header-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 100;
      background: var(--white);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    /* Logo å€å¡Šï¼šé«˜åº¦ç´„ 2cm */
    .logo-header {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 3cm;
      padding: 10px;
    }
    .logo-header img {
      max-height: 100%;
      max-width: 100%;
      object-fit: contain;
    }
    /* é¡åˆ¥é¸å–®å€ï¼šä½æ–¼ Logo ä¸‹æ–¹ç™½è‰²æ¡† */
    .top-bar {
      height: 100px;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow-x: auto;
      margin-bottom: 10px;
    }

 /* é¡åˆ¥é¸å–®å€æŒ‰éˆ•çš„ç·¨æ’â–¼ */
    .category-group {
      display: grid;
      grid-template-rows: repeat(2, 1fr);
      gap: 20px;
      padding: 10px 10px;
      align-items: center;
      justify-content: center;
    }
    .category-group .row-1 {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 25px;
    }
    .category-group .row-2 {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 25px;
      justify-content: center;
    }
 /* é¡åˆ¥é¸å–®å€æŒ‰éˆ•çš„ç·¨æ’â–² */

    .category-btn {
      padding: 8px 15px;
      border: none;
      border-radius: 12px;
      background-color: #ccc;
      color: var(--white);
      font-size: 12px;
      cursor: pointer;
      transition: background-color var(--transition-fast);
      width: 100%;
      white-space: nowrap;
    }
    .category-btn.selected {
      background-color: var(--brand-color);
    }
    /* =========================
       ä¸»å…§å®¹å€ï¼šèœå–®å€åŸŸ
       è¨­å®š margin-top ä»¥é¿é–‹å›ºå®š Headerï¼ˆç´„ 130pxï¼‰
       ========================= */
    .main-container {
      margin-top: 220px;
      padding: 15px;
    }
    .product-area {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px 0;
    }
    /* =========================
       èœå–®é¡¯ç¤ºå€ï¼šæ¯é  9 é …ï¼Œå­—é«”èª¿å° 1ptï¼ˆ12pxï¼‰
       ========================= */
    .menu-container {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin-top: 25px;
      padding-bottom: 20px;
      max-width: 1200px;
      margin-left: auto;
    }
   .menu-item {
  background: var(--white);
  border-radius: 8px;
  padding: 10px;
  cursor: pointer;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  transition: transform var(--transition-fast);
transform: translateX(15px); /* æˆ–æ ¹æ“šéœ€è¦èª¿æ•´ç‚º 5-10px */
}
    .menu-item:hover {
      transform: translateY(-2px);
      background: var(--bg-color);
    }
    .menu-item img {
      width: auto;
      height: auto;
      max-width: 100%;
      max-height: 172.5px;
      object-fit: contain;
      border-radius: 4px;
      margin-bottom: 10px;
      background: #f8f8f8;
    }
    .menu-item.selected {
      border: 2px solid var(--brand-color);
    }
    .menu-item p {
      font-size: 12px;
      margin: 0;
    }
    .quantity-controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
    }
    /* =========================
       è¨‚å–®æ¨¡å¼èˆ‡åˆ†é æ§åˆ¶å€ï¼š
       æ”¾åœ¨èœå–®å€ä¸‹æ–¹ï¼Œä¸å›ºå®šï¼Œç¢ºä¿å‡ºç¾åœ¨ 9 é …èœå“çš„ä¸‹æ–¹
       ========================= */
    .order-mode-container {
      margin: 20px auto 0;
      padding: 10px 22px;
      background: rgba(255, 255, 255, 0.95);
      box-shadow: 0 -2px 4px rgba(0,0,0,0.1);
      max-width: 1200px;
      /* æ–°å¢é€™è¡Œï¼Œå‘å³ç§»å‹• */
       transform: translateX(12px);
    }
    .order-mode-buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 10px;
    }
    .mode-btn {
      background: var(--brand-color);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .mode-btn:hover {
      background: var(--brand-color-dark);
    }
    /* åˆ†é æ§åˆ¶ */
    .actions {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      margin-bottom: 10px;
    }
    .actions button {
      background: var(--brand-color);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .actions button:hover {
      background: var(--brand-color-dark);
    }
    .page-info {
      white-space: nowrap;
      font-size: 14px;
    }
    /* æ¡Œè™Ÿé¸æ“‡æŒ‰éˆ•ï¼ˆå…§ç”¨æ™‚é¡¯ç¤ºï¼‰ */
    .table-btn {
      padding: 10px 20px;
      margin: 5px;
      border: none;
      border-radius: 4px;
      background: var(--brand-color);
      color: white;
      cursor: pointer;
      width: calc(16.66% - 10px);
    }
    .table-btn:hover {
      background: var(--brand-color-dark);
    }
    #tableSelectContainer {
      display: flex;
      flex-wrap: wrap;
      justify-content: flex-start;
      gap: 10px;
      padding: 10px;
      max-width: 600px;
      margin: 0 auto;
    }
    /* =========================
       è³¼ç‰©è»Šå€ï¼šæ”¹ç‚ºéå›ºå®šï¼Œéš¨é é¢å…§å®¹æ“´å±•
       è«‹åˆªé™¤åŸæœ¬çš„å›ºå®šå®šä½è¨­å®šï¼ˆå¾ "position: fixed;" è‡³ "bottom: 0;" åŠ "max-height: 40vh;"ï¼‰
       ä¸¦åŠ å…¥ margin-top ä»¥èˆ‡ä¸Šæ–¹å€å¡Šåˆ†éš”
       ========================= */
    #cart {
      width: 100%;
      background: var(--cart-bg);
      padding: 20px;
      border-radius: 12px 12px 0 0;
      box-shadow: 0 -4px 8px rgba(0,0,0,0.1);
      overflow-y: auto;
      transition: all 0.3s ease;
      z-index: 1001;
      display: flex;
      flex-direction: column;
      margin-top: 20px;
    }
    /* èª¿æ•´è³¼ç‰©è»Šæ¸…å–®å·¦å³å…§é‚Šè· */
    #cartList {
      list-style: none;
      padding: 0 20px;
      margin: 0;
      overflow-y: auto;
      /* å–æ¶ˆå›ºå®šé«˜åº¦ï¼Œè®“è³¼ç‰©è»Šéš¨å…§å®¹æ“´å±• */
    }
    #cartList li {
      margin-bottom: 10px;
      padding: 5px;
      border-bottom: 1px solid var(--border-color);
    }

    #cartList li:last-child {
      border-bottom: none;
      font-weight: bold;
      display: flex;
      justify-content: flex-start; /* æ”¹ç‚ºé å·¦æ’åˆ— */
      align-items: center;
    }
    .total-price {
      color: var(--brand-color);
      font-size: 1.2em;
      display: inline;
    }
    /* =========================
       Modal èˆ‡é€šçŸ¥
       ========================= */
    .notification {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.95);
      color: white;
      padding: 0;
      z-index: 1000;
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
      font-size: 3em;
      line-height: 1.5;
    }
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal-content {
      background: white;
      padding: 40px;
      border-radius: 15px;
      text-align: center;
      width: 90vw;
      height: 90vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      font-size: 2em;
    }
    .modal-content button {
      background: var(--brand-color);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      margin-top: 10px;
      cursor: pointer;
    }
    /* å¤–å¸¶æç¤ºæ–‡å­—è‡ªå‹•æ›è¡Œ */
    .takeout-notice {
      color: #dc3545;
      margin: 10px 0;
      text-align: center;
      white-space: normal;
    }
    /* å¤–å¸¶è¨‚å–®è™Ÿç¢¼é¡¯ç¤ºæ¨£å¼ */
    .takeout-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      color: white;
      text-align: center;
    }
    .takeout-overlay h1 {
      font-size: 4em;
      margin-bottom: 20px;
    }
    .takeout-overlay p {
      font-size: 1.5em;
      line-height: 1.6;
    }
    /* è¨‚å–®ç¢ºèªæŒ‰éˆ•å€ï¼šç¢ºä¿ç¢ºèªèˆ‡å–æ¶ˆæŒ‰éˆ•åŒå¯¬ */
    .order-buttons {
      display: flex;
      gap: 10px;
      width: 100%;
    }
    .order-buttons button {
      flex: 1;
    }
    /* è³¼ç‰©è»Šæ¨™é¡Œå€åŸŸæ¨£å¼ */
    .cart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    .cart-header h3 {
      margin: 0;
    }
    #categoryTitle {
   text-align: center;
padding-left: 22px;
    }
    #submitOrderBtn {
      margin-left: 10px;
      white-space: nowrap;
    }
  </style>
</head>
<body>
  <!-- Header å€å¡Šï¼šåŒ…å« Logo èˆ‡é¡åˆ¥é¸å–® -->
  <div class="header-container">
    <!-- Logo å€ -->
    <div class="logo-header">
      <!-- è«‹æ›¿æ› images/logo.png ç‚ºå¯¦éš›åº—å®¶ Logo åœ–æª” -->
      <img src="images/123.jpg" alt="åº—å®¶ Logo">
    </div>
    <!-- é¡åˆ¥é¸å–® -->
    <div class="top-bar">
      <div class="category-group">
        <div class="row-1">
          <button class="category-btn" id="btn-a" onclick="selectCategory('éºµé£Ÿ')">éºµé£Ÿ</button>
          <button class="category-btn" id="btn-b" onclick="selectCategory('æ¹¯é¡')">æ¹¯é¡</button>
          <button class="category-btn" id="btn-c" onclick="selectCategory('ç‰¹è£½æ»·èœ')">ç‰¹è£½æ»·èœ</button>
          <button class="category-btn" id="btn-d" onclick="selectCategory('é¬†é¤…')">é¬†é¤…</button>
        </div>
        <div class="row-2">
          <button class="category-btn" id="btn-e" onclick="selectCategory('è›‹é¤…')">è›‹é¤…</button>
          <button class="category-btn" id="btn-f" onclick="selectCategory('é£²æ–™')">é£²æ–™</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ä¸»å…§å®¹å€ï¼šåŒ…å«èœå–®å±•ç¤ºåŠè¨‚å–®æ¨¡å¼èˆ‡åˆ†é æ§åˆ¶ -->
  <div class="main-container">
    <div class="product-area">
      <!-- é¡åˆ¥æ¨™é¡Œ -->
      <h2 id="categoryTitle">é¸æ“‡æ‚¨çš„é¤é»</h2>
      <!-- èœå–®é¡¯ç¤ºå€ï¼šæ¯é é¡¯ç¤º 9 é … -->
      <div class="menu-container" id="menu">
        <!-- æ­¤è™•å°‡å‹•æ…‹æ¸²æŸ“èœå“ -->
      </div>
    </div>
    <!-- è¨‚å–®æ¨¡å¼èˆ‡åˆ†é æ§åˆ¶å€ï¼Œæ”¾åœ¨èœå–®ä¸‹æ–¹ -->
    <div class="order-mode-container" id="orderModeContainer">
      <!-- å…§ç”¨ï¼å¤–å¸¶æŒ‰éˆ• -->
      <div class="order-mode-buttons">
        <button class="mode-btn" onclick="selectDineIn()">å…§ç”¨</button>
        <button class="mode-btn" onclick="selectTakeOut()">å¤–å¸¶</button>
      </div>
      <!-- æ¡Œè™Ÿé¸æ“‡å€ï¼ˆå…§ç”¨æ™‚é¡¯ç¤ºï¼‰ -->
      <div class="table-select-container" id="tableSelectContainer" style="display: none;"></div>
      <!-- åˆ†é æ§åˆ¶ -->
      <div class="actions">
        <button onclick="prevPage()">ä¸Šä¸€é </button>
        <div class="page-info">
          ç¬¬ <span id="currentPageNumber">1</span> é 
        </div>
        <button onclick="nextPage()">ä¸‹ä¸€é </button>
      </div>
      <!-- é€å‡ºè¨‚å–®æŒ‰éˆ•å·²ç§»è‡³è³¼ç‰©è»Šæ¨™é¡Œå€åŸŸ -->
    </div>
  </div>

  <!-- è³¼ç‰©è»Šå€ï¼šéš¨é é¢å…§å®¹æ“´å±• -->
  <div id="cart">
    <div class="cart-header">
      <h3>ğŸ›’ æ‚¨çš„è³¼ç‰©è»Šæ¸…å–®ï¼š</h3>
      <button class="mode-btn" id="submitOrderBtn" style="display: none;" onclick="showConfirmation()">é€å‡ºè¨‚å–®</button>
    </div>
    <ul id="cartList">
      <!-- è³¼ç‰©è»Šé …ç›®å°‡ä¾æ¬¡æ–°å¢æ–¼æ­¤ -->
    </ul>
  </div>

  <!-- Modal è¦–çª—ï¼šç”¨æ–¼é¡¯ç¤ºæç¤ºè¨Šæ¯ -->
  <div id="customModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <p id="modalMessage">é€™è£¡æœƒé¡¯ç¤ºæç¤ºè¨Šæ¯</p>
      <button onclick="closeModal()">ç¢ºèª</button>
    </div>
  </div>

  <!-- =========================
       JavaScript ç¨‹å¼ç¢¼å€
       ========================= -->
  <script>
    /***********************
     * è³‡æ–™è¨­å®šèˆ‡å…¨åŸŸè®Šæ•¸ *
     ***********************/
    const menuData = {
      "éºµé£Ÿ": [
        { name: "ç´…ç‡’ç‰›è‚‰éºµ", price: 230, img: "images/food1.jpg" },
        { name: "æ¸…ç‡‰ç‰›è‚‰éºµ", price: 230, img: "images/food2.jpg" },
        { name: "éº»è¾£ç‰›è‚‰éºµ", price: 235, img: "images/food3.jpg" },
        { name: "ç‰›ç­‹éºµ",     price: 235, img: "images/food4.jpg" },
        { name: "ç´…ç‡’ç‰›è…©éºµ", price: 230, img: "images/food5.jpg" },
        { name: "ç‰›å°¾éºµ",     price: 230, img: "images/food6.jpg" },
        { name: "ç‰›ä¸‰å¯¶éºµ",   price: 240, img: "images/food7.jpg" },
        { name: "ç‰›å°æ’éºµ",   price: 300, img: "images/food8.jpg" },
        { name: "ç‰›æ’éºµ",     price: 300, img: "images/food9.jpg" },
        { name: "é™½æ˜¥éºµ",     price: 40,  img: "images/food10.jpg" }
      ],
      "æ¹¯é¡": [
        { name: "ç´…ç‡’ç‰›è‚‰æ¹¯", price: 200, img: "images/food11.jpg" },
        { name: "æ¸…ç‡‰ç‰›è‚‰æ¹¯", price: 200, img: "images/food12.jpg" },
        { name: "éº»è¾£ç‰›è‚‰æ¹¯", price: 205, img: "images/food13.jpg" },
        { name: "ç‰›ç­‹æ¹¯",     price: 205, img: "images/food14.jpg" },
        { name: "ç´…ç‡’ç‰›è…©æ¹¯", price: 200, img: "images/food15.jpg" },
        { name: "é¤›é£©æ¹¯",     price: 50,  img: "images/food16.jpg" },
        { name: "ç‰›è‚šæ¹¯",     price: 200, img: "images/food17.jpg" },
        { name: "ç‰›é›œæ¹¯",     price: 200, img: "images/food18.jpg" },
        { name: "ç‰›å°¾æ¹¯",     price: 200, img: "images/food19.jpg" }
      ],
      "ç‰¹è£½æ»·èœ": [
        { name: "é­¯è›‹",       price: 10,  img: "images/food20.jpg" },
        { name: "æ»·å‘³æ‹¼ç›¤",   price: 150, img: "images/food21.jpg" },
        { name: "æ»·ç‰›è…±",     price: 80,  img: "images/food22.jpg" },
        { name: "æ»·ç‰›è‚š",     price: 80,  img: "images/food23.jpg" },
        { name: "æ»·ç‰›é›œ",     price: 80,  img: "images/food24.jpg" },
        { name: "æ»·ç‰›è…©",     price: 80,  img: "images/food25.jpg" },
        { name: "ç‰›ç­‹",       price: 100, img: "images/food26.jpg" },
        { name: "æµ·å¸¶",       price: 20,  img: "images/food27.jpg" },
        { name: "è±†å¹²",       price: 20,  img: "images/food28.jpg" }
      ],
      "é¬†é¤…": [
        { name: "åŸå‘³é¬†é¤…", price: 120, img: "images/food29.jpg" },
        { name: "å·§å…‹åŠ›é¬†é¤…", price: 130, img: "images/food30.jpg" },
        { name: "èœ‚èœœé¬†é¤…", price: 130, img: "images/food31.jpg" },
        { name: "è—è“é¬†é¤…", price: 140, img: "images/food32.jpg" },
        { name: "é¦™è•‰é¬†é¤…", price: 140, img: "images/food33.jpg" },
        { name: "æŠ¹èŒ¶é¬†é¤…", price: 150, img: "images/food34.jpg" },
        { name: "å¥¶æ²¹é¬†é¤…", price: 120, img: "images/food35.jpg" }
      ],
      "è›‹é¤…": [
        { name: "åŸå‘³è›‹é¤…", price: 60, img: "images/food36.jpg" },
        { name: "èµ·å¸è›‹é¤…", price: 70, img: "images/food37.jpg" },
        { name: "åŸ¹æ ¹è›‹é¤…", price: 75, img: "images/food38.jpg" },
        { name: "ç«è…¿è›‹é¤…", price: 70, img: "images/food39.jpg" },
        { name: "ç‰ç±³è›‹é¤…", price: 65, img: "images/food40.jpg" },
        { name: "è”¬èœè›‹é¤…", price: 70, img: "images/food41.jpg" }
      ],
      "é£²æ–™": [
        { name: "ç´…èŒ¶", price: 30, img: "images/food42.jpg" },
        { name: "å¥¶èŒ¶", price: 40, img: "images/food43.jpg" },
        { name: "ç¶ èŒ¶", price: 30, img: "images/food44.jpg" },
        { name: "ç¾å¼å’–å•¡", price: 50, img: "images/food45.jpg" },
        { name: "æ‹¿éµ", price: 60, img: "images/food46.jpg" },
        { name: "å¯å¯", price: 55, img: "images/food47.jpg" }
      ]
    };
    // å…¨åŸŸè®Šæ•¸ï¼šç›®å‰é¸å–çš„é¡åˆ¥ã€è³¼ç‰©è»Šé …ç›®ã€åˆ†é ã€è¨‚å–®æ¨¡å¼èˆ‡æ¡Œè™Ÿ
    let selectedCategory = "éºµé£Ÿ";
    let selectedItems = new Map();
    let currentPage = 0;
    const itemsPerPage = 9;
    let orderType = "";
    let selectedTableNumber = "";

    /********************
     * åˆå§‹è¼‰å…¥èˆ‡äº‹ä»¶ *
     ********************/
    window.onload = () => {
      console.log("Window loaded, initializing...");
      updateCategoryButtons();
      renderMenu();
      updateCart();
      generateTableButtons();
    };

    /********************
     * é¡åˆ¥é¸å–®ç›¸é—œå‡½æ•¸ *
     ********************/
    function selectCategory(category) {
      selectedCategory = category;
      currentPage = 0;
      updateCategoryButtons();
      renderMenu();
    }
    function updateCategoryButtons() {
      document.getElementById("btn-a").classList.remove("selected");
      document.getElementById("btn-b").classList.remove("selected");
      document.getElementById("btn-c").classList.remove("selected");
      document.getElementById("btn-d").classList.remove("selected");
      document.getElementById("btn-e").classList.remove("selected");
      document.getElementById("btn-f").classList.remove("selected");
      if (selectedCategory === "éºµé£Ÿ") {
        document.getElementById("btn-a").classList.add("selected");
      } else if (selectedCategory === "æ¹¯é¡") {
        document.getElementById("btn-b").classList.add("selected");
      } else if (selectedCategory === "ç‰¹è£½æ»·èœ") {
        document.getElementById("btn-c").classList.add("selected");
      } else if (selectedCategory === "é¬†é¤…") {
        document.getElementById("btn-d").classList.add("selected");
      } else if (selectedCategory === "è›‹é¤…") {
        document.getElementById("btn-e").classList.add("selected");
      } else if (selectedCategory === "é£²æ–™") {
        document.getElementById("btn-f").classList.add("selected");
      }
      document.getElementById("categoryTitle").textContent = selectedCategory;
    }
    function getCurrentCategoryItems() {
      return menuData[selectedCategory] || [];
    }

    /********************
     * èœå–®æ¸²æŸ“å‡½æ•¸ *
     ********************/
    function renderMenu() {
      let menuContainer = document.getElementById("menu");
      menuContainer.innerHTML = "";
      let allItems = getCurrentCategoryItems();
      if (!allItems || allItems.length === 0) {
        menuContainer.innerHTML = "<p>ç›®å‰æ²’æœ‰å•†å“</p>";
        console.log("No items found for category:", selectedCategory);
        return;
      }
      let start = currentPage * itemsPerPage;
      let end = start + itemsPerPage;
      let pageItems = allItems.slice(start, end);
      document.getElementById("currentPageNumber").innerText = currentPage + 1;
      pageItems.forEach((item, index) => {
        try {
          let div = document.createElement("div");
          div.classList.add("menu-item");
          let selected = selectedItems.get(item.name);
          if (selected) { div.classList.add("selected"); }
          let imgSrc = item.img || "https://via.placeholder.com/100";
          let itemName = item.name || "æœªçŸ¥å•†å“";
          let itemPrice = item.price || 0;
          div.innerHTML = `
            <img src="${imgSrc}" alt="${itemName}" onerror="this.src='https://via.placeholder.com/100'">
            <p>${itemName} ($${itemPrice})</p>
            ${selected ? `
              <div class="quantity-controls">
                <button onclick="decreaseQuantity('${itemName}', event)">-</button>
                <span>${selected.quantity}</span>
                <button onclick="increaseQuantity('${itemName}', event)">+</button>
              </div>` : ""}
          `;
          if (!selected) div.onclick = () => toggleSelection(item);
          menuContainer.appendChild(div);
        } catch (error) {
          console.error(`Error rendering item at index ${index}:`, item, error);
        }
      });
    }

    /********************
     * è³¼ç‰©è»Šæ›´æ–°å‡½æ•¸ *
     ********************/
    function updateCart() {
      let cartList = document.getElementById("cartList");
      cartList.innerHTML = "";
      if (selectedItems.size === 0) {
        cartList.innerHTML = "<p style='color: #999;'>è³¼ç‰©è»Šæ˜¯ç©ºçš„</p>";
        return;
      }
      let totalPrice = 0;
      for (let [name, { item, quantity }] of selectedItems) {
        let li = document.createElement("li");
        li.textContent = `${name} ($${item.price}) x ${quantity}`;
        cartList.appendChild(li);
        totalPrice += item.price * quantity;
      }
      let totalLi = document.createElement("li");
      totalLi.innerHTML = `ç´¯è¨ˆç¸½é‡‘é¡ï¼š<span class="total-price">$${totalPrice}</span>`;
      cartList.appendChild(totalLi);
      cartList.scrollTop = cartList.scrollHeight;
    }

    /********************
     * èœå–®é …ç›®æ•¸é‡æ›´æ–°èˆ‡é¸å–å‡½æ•¸ *
     ********************/
    function updateItemQuantity(name, delta, event = null) {
      if (event) event.stopPropagation();
      let current = selectedItems.get(name);
      if (current) {
        current.quantity += delta;
        if (current.quantity <= 0) {
          selectedItems.delete(name);
        }
      } else if (delta > 0) {
        const item = menuData[selectedCategory].find(i => i.name === name);
        if (item) selectedItems.set(name, { item, quantity: 1 });
      }
      renderMenu();
      updateCart();
    }
    function toggleSelection(item) {
      updateItemQuantity(item.name, 1);
    }
    function increaseQuantity(name, event) {
      updateItemQuantity(name, 1, event);
    }
    function decreaseQuantity(name, event) {
      updateItemQuantity(name, -1, event);
    }

    /********************
     * åˆ†é æ§åˆ¶å‡½æ•¸ *
     ********************/
    function prevPage() {
      if (currentPage > 0) {
        currentPage--;
        renderMenu();
      } else {
        showNotification("é€™å·²æ˜¯ç¬¬ä¸€é ");
      }
    }
    function nextPage() {
      let allItems = getCurrentCategoryItems();
      let maxPages = Math.ceil(allItems.length / itemsPerPage) - 1;
      if (currentPage < maxPages) {
        currentPage++;
        renderMenu();
      } else {
        showNotification("é€™å·²æ˜¯æœ€å¾Œä¸€é ");
      }
    }

    /********************
     * è¨‚å–®æ¨¡å¼èˆ‡æ¡Œè™Ÿé¸æ“‡å‡½æ•¸ *
     ********************/
    function selectDineIn() {
      orderType = "å…§ç”¨";
      document.querySelector(".order-mode-buttons").style.display = "none";
      selectedTableNumber = "";
      document.getElementById("tableSelectContainer").style.display = "flex";
      let tableMsg = document.createElement("div");
      tableMsg.textContent = "è«‹é»é¸ä½ çš„æ¡Œè™Ÿ";
      tableMsg.style.textAlign = "center";
      tableMsg.style.marginBottom = "10px";
      tableMsg.id = "tableMsgText";
      let existingMsg = document.getElementById("tableMsgText");
      if (existingMsg) { existingMsg.remove(); }
      document.getElementById("tableSelectContainer").insertAdjacentElement("beforebegin", tableMsg);
      document.getElementById("submitOrderBtn").style.display = "none";
    }
    function selectTakeOut() {
      orderType = "å¤–å¸¶";
      document.querySelector(".order-mode-buttons").style.display = "none";
      selectedTableNumber = "";
      document.getElementById("tableSelectContainer").style.display = "none";
      document.getElementById("submitOrderBtn").style.display = "inline-block";
    }
    function generateTableButtons() {
      let container = document.getElementById("tableSelectContainer");
      container.innerHTML = "";
      for (let i = 1; i <= 15; i++) {
        let btn = document.createElement("button");
        btn.classList.add("table-btn");
        btn.textContent = i;
        btn.onclick = () => {
          selectedTableNumber = i;
          container.style.display = "none";
          let tableMsgText = document.getElementById("tableMsgText");
          if (tableMsgText) { tableMsgText.remove(); }
          document.getElementById("submitOrderBtn").style.display = "inline-block";
        };
        container.appendChild(btn);
      }
    }

    /********************
     * è¨‚å–®é©—è­‰èˆ‡ç¢ºèªå‡½æ•¸ *
     ********************/
    function validateOrder() {
      if (selectedItems.size === 0) {
        showModal("è«‹è‡³å°‘é¸æ“‡ä¸€é …èœå“ï¼");
        return false;
      }
      if (!orderType) {
        showModal("è«‹å…ˆé¸æ“‡å…§ç”¨æˆ–å¤–å¸¶ï¼");
        return false;
      }
      if (orderType === "å…§ç”¨" && !selectedTableNumber) {
        showModal("è«‹å…ˆé¸æ“‡æ¡Œè™Ÿï¼");
        return false;
      }
      return true;
    }
    function showConfirmation() {
      if (!validateOrder()) return;
      // ç«‹å³éš±è—é€å‡ºè¨‚å–®æŒ‰éˆ•
      document.getElementById("submitOrderBtn").style.display = "none";
      const cartDiv = document.getElementById("cart");
      cartDiv.classList.add("cart-confirmation");
      cartDiv.querySelector("h3").textContent = "è«‹æœ€å¾Œç¢ºèªä½ çš„é¤é»";
      document.getElementById("orderModeContainer").style.display = "none";
      const buttonContainer = document.createElement("div");
      buttonContainer.style.display = "flex";
      buttonContainer.style.flexDirection = "column";
      buttonContainer.style.alignItems = "center";
      buttonContainer.style.marginTop = "10px";
      if (orderType === "å¤–å¸¶") {
        const notice = document.createElement("div");
        notice.className = "takeout-notice";
        notice.innerHTML = "âš ï¸ é»æ“Šç¢ºèªè¨‚å–®å¾Œè«‹æˆªåœ–æ¡Œé¢ä½ çš„å–é¤è™Ÿç¢¼";
        buttonContainer.appendChild(notice);
      }
      const orderButtons = document.createElement("div");
      orderButtons.className = "order-buttons";
      const confirmBtn = document.createElement("button");
      confirmBtn.textContent = "ç¢ºèªè¨‚å–®ä¸¦è‡³æ«ƒæª¯ä»˜æ¬¾";
      confirmBtn.className = "confirm-order-btn";
      confirmBtn.onclick = confirmOrder;
      const cancelBtn = document.createElement("button");
      cancelBtn.textContent = "å–æ¶ˆè¨‚å–®";
      cancelBtn.className = "cancel-order-btn";
      cancelBtn.onclick = cancelOrder;
      orderButtons.appendChild(confirmBtn);
      orderButtons.appendChild(cancelBtn);
      orderButtons.style.flexDirection = "column";
      orderButtons.style.gap = "10px";
      confirmBtn.style.backgroundColor = "#2e7d32";
      confirmBtn.style.color = "white";
      confirmBtn.style.padding = "12px 20px";
      confirmBtn.style.border = "none";
      confirmBtn.style.borderRadius = "5px";
      confirmBtn.style.cursor = "pointer";
      cancelBtn.style.backgroundColor = "#d32f2f";
      cancelBtn.style.color = "white";
      cancelBtn.style.padding = "12px 20px";
      cancelBtn.style.border = "none";
      cancelBtn.style.borderRadius = "5px";
      cancelBtn.style.cursor = "pointer";
      confirmBtn.style.fontSize = "16px";
      cancelBtn.style.fontSize = "16px";
      confirmBtn.style.width = "100%";
      cancelBtn.style.width = "100%";
      confirmBtn.style.transition = "background-color 0.3s";
      cancelBtn.style.transition = "background-color 0.3s";
      confirmBtn.addEventListener('mouseover', () => confirmBtn.style.backgroundColor = "#1b5e20");
      confirmBtn.addEventListener('mouseout', () => confirmBtn.style.backgroundColor = "#2e7d32");
      cancelBtn.addEventListener('mouseover', () => cancelBtn.style.backgroundColor = "#b71c1c");
      cancelBtn.addEventListener('mouseout', () => cancelBtn.style.backgroundColor = "#d32f2f");
      buttonContainer.appendChild(orderButtons);
      cartDiv.appendChild(buttonContainer);
    }
    function confirmOrder() {
      // ç«‹å³éš±è—ç¢ºèªè¨‚å–®æŒ‰éˆ•
      document.querySelector('.confirm-order-btn').style.display = 'none';
      
      let tableValue = (orderType === "å…§ç”¨") ? selectedTableNumber : "å¤–å¸¶";
      let itemsArray = Array.from(selectedItems).map(([name, { item, quantity }]) => ({
        name: item.name,
        price: item.price,
        quantity: quantity
      }));
      fetch('/submit-order', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ table: tableValue, items: itemsArray })
      })
      .then(response => response.json())
      .then(data => {
          if (orderType === "å¤–å¸¶" && data.takeoutNumber) {
               showTakeoutOverlay(data.takeoutNumber);
          } else {
               showDineInOverlay(selectedTableNumber);
          }
      })
      .catch(error => {
        showModal("ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹é‡è©¦ï¼");
        console.error("æäº¤è¨‚å–®éŒ¯èª¤", error);
      });
    }
    function showTakeoutOverlay(number) {
      let overlay = document.createElement("div");
      overlay.className = "takeout-overlay";
      const now = new Date();
      const timeString = now.toLocaleString('zh-TW', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
      overlay.innerHTML = `
           <h1>${number}</h1>
           <p>é€™æ˜¯æ‚¨çš„å¤–å¸¶è¨‚å–®è™Ÿç¢¼<br>
           è«‹æˆªåœ–ä¿å­˜ï¼Œ<br>
           7ç§’å¾Œè‡ªå‹•é—œé–‰æ­¤ç•«é¢</p>
           <p class="order-time">è¨‚å–®æ™‚é–“ï¼š${timeString}</p>
      `;
      document.body.appendChild(overlay);
      setTimeout(() => {
           overlay.remove();
           location.reload();
      }, 7000);
    }

    function showDineInOverlay(tableNumber) {
      let overlay = document.createElement("div");
      overlay.className = "takeout-overlay";
      const now = new Date();
      const timeString = now.toLocaleString('zh-TW', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
      overlay.innerHTML = `
           <h1>${tableNumber} è™Ÿæ¡Œ</h1>
           <p>æ‚¨çš„è¨‚å–®å·²ç¢ºèª<br>
           è«‹è€å¿ƒç­‰å€™ï¼Œ<br>
           7ç§’å¾Œè‡ªå‹•é—œé–‰æ­¤ç•«é¢</p>
           <p class="order-time">è¨‚å–®æ™‚é–“ï¼š${timeString}</p>
      `;
      document.body.appendChild(overlay);
      setTimeout(() => {
           overlay.remove();
           location.reload();
      }, 7000);
    }
    function cancelOrder() {
      location.reload();
    }

    /********************
     * Modal èˆ‡é€šçŸ¥å‡½æ•¸ *
     ********************/
    function showModal(message) {
      let modal = document.getElementById("customModal");
      let msg = document.getElementById("modalMessage");
      msg.textContent = message;
      modal.style.display = "flex";
    }
    function closeModal() {
      document.getElementById("customModal").style.display = "none";
    }
    function showNotification(message) {
      let existingNotification = document.querySelector(".notification");
      if (existingNotification) existingNotification.remove();
      let notification = document.createElement("div");
      notification.className = "notification";
      notification.innerText = message;
      document.body.appendChild(notification);
      setTimeout(() => { notification.remove(); }, 3000);
    }
  </script>
</body>
</html>
